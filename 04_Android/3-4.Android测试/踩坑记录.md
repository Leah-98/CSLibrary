# 踩坑记录

## 已解决的问题

- **关于Android Studio单元测试中“Method d in android.util.Log not mocked.”问题的解决。**

https://blog.csdn.net/qq_38910403/article/details/102639487



- **运行JUnit测试方法时出现提示No tasks available**

make sure your project structure is correct. Your tests should be in **src>test>java**

https://stackoverflow.com/questions/57908805/no-tasks-available-when-executing-junit-runner-class



- **工程中没有test或androidTest文件夹**

新建test文件夹在src目录下，并右键选择Mark Directory as > Test Sources Root

https://stackoverflow.com/questions/50605266/how-can-i-add-test-folders-in-android-studio



- **生成Junit3测试正常，但Junit4无法识别到里面的Test case**

生成Junit4用例时，父类要设置成junit.framework.TestCase，不然没法识别到里面的测试case



- **在Junit3的Test case中使用Robolectric会自动下载4.1....版本，但下载失败**

Robolectric4.6.x要配合Junit4一起使用



- **Robolectic测试case一直被忽略**

https://github.com/robolectric/robolectric/issues/7249

因为找不到Android Resources，

在build.gradle(app) android{}里加上

```groovy
testOptions {
    unitTests.includeAndroidResources = true
}
```



- **Robolectirc4.3.1最高支持到SDK 29，但项目是31的**

将Robolectric升级到4.7+



- **Robolectric升级到4.7+后，运行测试提示 Unsupported class file major version 59**

查了一下是因为Robolectric 4.7+不支持JDK 15 ，但是项目用的是JDK 1.8 

如果在gradle文件中配置不允许使用JDK15，还是继续报错

JDK改成了11,或经过不明步骤后，报错变为：

```
Execution failed for task ':app:compileProdDebugUnitTestJavaWithJavac'.
> Could not resolve all files for configuration ':app:prodDebugUnitTestCompileClasspath'.
   > Failed to transform bcprov-jdk15on-1.68.jar (org.bouncycastle:bcprov-jdk15on:1.68) to match attributes {artifactType=android-classes-jar, org.gradle.category=library, org.gradle.libraryelements=jar, org.gradle.status=release, org.gradle.usage=java-api}.
      > Execution failed for JetifyTransform: C:\Users\5109U25854\.gradle\caches\modules-2\files-2.1\org.bouncycastle\bcprov-jdk15on\1.68\46a080368d38b428d237a59458f9bc915222894d\bcprov-jdk15on-1.68.jar.
```

找到相关的Issues

Jetifier fails on bcprov-jdk15on-1.68.jar / Robolectric 4.6-alpha-2 #6521

https://github.com/robolectric/robolectric/issues/6521

Gradle版本改成最新的就解决了

```
Android Gradle Plugin Version 
7.2.1
Gradle Version
7.3.3
```



- 找不到可执行的test 方法

需要在方面前加上@Test注解

Log：

```
Invalid test class 'com.sony.dtv.appassistant.PermissionPromptActivityTest':
  1. No runnable methods
org.junit.runners.model.InvalidTestClassError: Invalid test class 'com.sony.dtv.appassistant.PermissionPromptActivityTest':
  1. No runnable methods
	at org.junit.runners.ParentRunner.validate(ParentRunner.java:525)
	at org.junit.runners.ParentRunner.<init>(ParentRunner.java:102)
	at org.junit.runners.BlockJUnit4ClassRunner.<init>(BlockJUnit4ClassRunner.java:84)
	at org.junit.runners.JUnit4.<init>(JUnit4.java:23)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:490)
```



- 在类前使用注解@Runwith(RoboletricTestRunner.class)的报错

报错Log：

```
Got more than one input Future failure. Logging failures after the first
```

注解改成@Runwith(Junit4.class)



- 使用Powermock调用到Method v in android.util.Log not mocked

gradle里配置

```
android {
    // ...
    testOptions {
        unitTests.returnDefaultValues = true
    }
}
```

https://qiita.com/oxsoft/items/b12b7a6c17e92eb880cd



## 暂时不明的问题

- Robolectric的@Config注解里少了constants属性